<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Weazel Eventkalender Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }
        h1 { margin-top: 0; color: #c92b2b; text-transform: uppercase; letter-spacing: 2px; }
        
        .main-layout {
            display: flex;
            flex: 1;
            gap: 20px;
            overflow: hidden;
        }

        /* Controls */
        .editor-panel {
            width: 400px;
            background-color: #161616;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .section-title {
            color: #c92b2b;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            text-transform: uppercase;
        }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #888; font-size: 0.9em; }
        input, select, textarea {
            width: 100%;
            background-color: #222;
            border: 1px solid #444;
            color: #fff;
            padding: 8px;
            border-radius: 4px;
            font-family: inherit;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus { border-color: #c92b2b; outline: none; }

        .btn {
            background-color: #c92b2b;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            margin-top: 10px;
        }
        .btn:hover { background-color: #a01b1b; }
        .btn-sm { padding: 5px 10px; font-size: 0.8em; width: auto; margin-top: 0; }
        .btn-add { background-color: #333; margin-top: 10px; }
        .btn-add:hover { background-color: #444; }

        /* Day Accordion */
        .day-section {
            border: 1px solid #333;
            border-radius: 4px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .day-header {
            background-color: #222;
            padding: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .day-header:hover { background-color: #2a2a2a; }
        .day-header.active { border-bottom: 1px solid #333; }
        
        .day-content {
            padding: 10px;
            background-color: #1a1a1a;
            display: none;
        }
        .day-content.open { display: block; }

        .event-item {
            background-color: #252525;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 3px solid #555;
            position: relative;
        }
        .event-item.highlight { border-left-color: #c92b2b; }
        
        .event-controls {
            display: flex;
            justify-content: flex-end;
            margin-top: 5px;
        }
        .btn-icon { background: none; border: none; color: #888; cursor: pointer; padding: 2px 5px; }
        .btn-icon:hover { color: #fff; }
        .btn-delete:hover { color: #ff5555; }

        /* Preview */
        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow: hidden;
        }
        .preview-window {
            flex: 1;
            background-color: #121212;
            border: 1px dashed #333;
            padding: 20px;
            overflow-y: auto;
        }
        .output-area {
            height: 150px;
            background-color: #000;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        .output-code {
            flex: 1;
            background: transparent;
            border: none;
            color: #a9b7c6;
            font-family: 'Consolas', monospace;
            font-size: 0.85em;
            padding: 10px;
            resize: none;
        }
        .output-controls {
            padding: 5px;
            text-align: right;
            border-top: 1px solid #333;
            background-color: #111;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background-color: #222;
            color: #fff;
            padding: 15px 25px;
            border-radius: 6px;
            border-left: 5px solid #c92b2b;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            z-index: 1000;
        }
        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .notification.success { border-left-color: #2ecc71; }
        .notification.error { border-left-color: #e74c3c; }
    </style>
</head>
<body>

    <div id="toast" class="notification">Benachrichtigung</div>

    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
        <h1>Eventkalender Generator</h1>
        <a href="index.html" style="color:#888; text-decoration:none; font-size:0.9em; border:1px solid #333; padding:5px 10px; border-radius:4px;">&larr; Zur√ºck</a>
    </header>

    <div class="main-layout">
        <div class="editor-panel">
            <div class="section-title">Importieren</div>
            <div class="form-group">
                <label>Vorhandenen Code hier einf√ºgen:</label>
                <textarea id="importCodeInput" placeholder="<div style=...>...</div>" style="height:100px;"></textarea>
                <button class="btn btn-secondary" onclick="importCode()">Daten laden</button>
            </div>

            <div class="section-title">Event-Woche</div>
            <div class="form-group">
                <label>Woche startet am (Montag):</label>
                <input type="date" id="startDate" onchange="updateDates()">
            </div>
            
            <div id="daysContainer">
                <!-- Days will be generated here -->
            </div>
        </div>

        <div class="preview-panel">
            <div class="preview-window">
                <div id="previewContent"> 
                </div>
            </div>

            <div class="output-area">
                <textarea id="outputCode" class="output-code" readonly></textarea>
                <div class="output-controls">
                    <button class="btn btn-sm" onclick="copyCode()">Code Kopieren</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Template for Inputs -->
    <div id="eventFormTemplate" style="display:none;">
        <div class="form-group">
            <input type="text" class="ev-title" placeholder="Titel (z.B. Live DJ)" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <input type="text" class="ev-host" placeholder="Veranstalter" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <input type="text" class="ev-loc" placeholder="Ort" oninput="updatePreview()">
        </div>
        <div style="display:flex; gap:10px;">
            <div class="form-group" style="flex:1;">
                <input type="text" class="ev-time" placeholder="Uhrzeit" oninput="updatePreview()">
            </div>
            <div class="form-group" style="flex:1;">
                <input type="text" class="ev-price" placeholder="Eintritt" oninput="updatePreview()">
            </div>
        </div>
        <div class="form-group">
            <input type="text" class="ev-img" placeholder="Bild URL (Optional)" oninput="updatePreview()">
        </div>
        <div class="form-group" style="display:flex; align-items:center; gap:10px;">
            <input type="checkbox" class="ev-highlight" style="width:auto;" onchange="updatePreview()"> 
            <label style="margin:0; display:inline;">Hervorheben</label>
        </div>
    </div>

    <script>
        // Init data with user provided recurring events
        // 0 = Monday, 6 = Sunday 
        const defaultEvents = {
            0: [
                { title: 'Tequi-La-La Live DJ', host: 'Tequi-La-La', loc: 'Tequi-La-La Vinewood', time: '21:30 - 0:00 Uhr', price: 'free' },
            ],
            1: [
                { title: 'Shamrock Tanzgruppe', host: 'Shamrock', loc: 'Shamrock', time: '20:00 Uhr', price: 'free' }
            ],
            2: [], // Wed
            3: [ // Thu
                { title: 'Tequi-La-La Live DJ', host: 'Tequi-La-La', loc: 'Tequi-La-La Vinewood', time: '21:30 - 0:00 Uhr', price: 'free' },
                { title: 'Shamrock Tanzgruppe', host: 'Shamrock', loc: 'Shamrock', time: '19:00 Uhr', price: 'free' },
                { title: 'Shamrock Late Night Joggen', host: 'Shamrock', loc: 'Shamrock', time: '22:30 Uhr', price: 'free' }
            ],
            4: [ // Fri
                { title: 'Boxkurs (auch f√ºr Einsteiger geeignet)', host: 'Shamrock', loc: 'Shamrock', time: 'ab 19 Uhr (ab 18:30 Einsteigerkurs)', price: '50$' }
            ],
            5: [ // Sat
                { title: 'Shamrock Tanzgruppe', host: 'Shamrock', loc: 'Shamrock', time: '14:30 Uhr', price: 'free' },
                { title: 'Shamrock Aquafitness', host: 'Shamrock', loc: 'Shamrock', time: '16:45 Uhr', price: 'free' }
            ],
            6: [ // Sun
                { title: 'Tequi-La-La Live DJ', host: 'Tequi-La-La', loc: 'Tequi-La-La Vinewood', time: '21:30 - 0:00 Uhr', price: 'free' }
            ]
        };

        const dayNames = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];
        let currentWeekStart = new Date();
        // Adjust to next Monday
        currentWeekStart.setDate(currentWeekStart.getDate() + (1 + 7 - currentWeekStart.getDay()) % 7);
        
        let events = JSON.parse(JSON.stringify(defaultEvents)); // Deep copy

        function init() {
            document.getElementById('startDate').valueAsDate = currentWeekStart;
            renderDays();
            updatePreview();
        }

        function updateDates() {
            const input = document.getElementById('startDate').valueAsDate;
            if (input) {
                currentWeekStart = input;
                // No update logic for day labels in editor needed, but definitely for preview
                renderDays(false); // don't reset inputs
                updatePreview();
            }
        }

        function toggleDay(idx) {
            const dayContent = document.getElementById(`day-content-${idx}`);
            dayContent.classList.toggle('open');
        }

        function renderDays(rebuild = true) {
            const container = document.getElementById('daysContainer');
            if (rebuild) container.innerHTML = '';
            
            let tempDate = new Date(currentWeekStart);

            for (let i = 0; i < 7; i++) {
                const dayDateStr = tempDate.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const dayLabel = `${dayNames[i]} (${dayDateStr})`;

                let section = document.getElementById(`day-section-${i}`);
                if (!section) {
                    section = document.createElement('div');
                    section.className = 'day-section';
                    section.id = `day-section-${i}`;
                    
                    section.innerHTML = `
                        <div class="day-header" onclick="toggleDay(${i})">
                            <span>${dayNames[i]} <span id="date-label-${i}" style="color:#888; font-size:0.8em; margin-left:5px;">${dayDateStr}</span></span>
                            <span style="font-size:1.2em;">+</span>
                        </div>
                        <div class="day-content" id="day-content-${i}">
                            <div id="events-list-${i}"></div>
                            <button class="btn btn-add" onclick="addEvent(${i})">Event Hinzuf√ºgen</button>
                        </div>
                    `;
                    container.appendChild(section);
                    renderEvents(i);
                } else {
                    // Update label only
                    document.getElementById(`date-label-${i}`).innerText = dayDateStr;
                }

                tempDate.setDate(tempDate.getDate() + 1);
            }
        }

        function renderEvents(dayIndex) {
            const list = document.getElementById(`events-list-${dayIndex}`);
            list.innerHTML = '';
            
            events[dayIndex].forEach((ev, evIndex) => {
                const el = document.createElement('div');
                el.className = `event-item ${ev.highlight ? 'highlight' : ''}`;
                
                // Color input display logic
                const showColor = ev.highlight ? 'inline-block' : 'none';

                el.innerHTML = `
                    <div class="form-group">
                        <input type="text" value="${ev.title}" placeholder="Titel" oninput="updateEvent(${dayIndex}, ${evIndex}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <input type="text" value="${ev.host}" placeholder="Veranstalter" oninput="updateEvent(${dayIndex}, ${evIndex}, 'host', this.value)">
                    </div>
                    <div style="display:flex; gap:5px;">
                        <input type="text" value="${ev.loc}" placeholder="Ort" style="flex:1" oninput="updateEvent(${dayIndex}, ${evIndex}, 'loc', this.value)">
                        <input type="text" value="${ev.time}" placeholder="Zeit" style="width:80px" oninput="updateEvent(${dayIndex}, ${evIndex}, 'time', this.value)">
                        <input type="text" value="${ev.price}" placeholder="Preis" style="width:80px" oninput="updateEvent(${dayIndex}, ${evIndex}, 'price', this.value)">
                    </div>
                     <div class="form-group" style="margin-top:5px;">
                        <input type="text" value="${ev.img || ''}" placeholder="Bild URL" oninput="updateEvent(${dayIndex}, ${evIndex}, 'img', this.value)">
                    </div>
                    <div class="form-group" style="margin-top:5px;">
                        <textarea placeholder="Zusatzinfos (Optional)" oninput="updateEvent(${dayIndex}, ${evIndex}, 'info', this.value)" style="height:50px; background-color:#222; border:1px solid #444; color:#fff; width:100%; border-radius:4px; padding:8px; font-family:inherit;">${ev.info || ''}</textarea>
                    </div>
                    <div class="event-controls">
                        <div style="display:flex; align-items:center;">
                            <label style="margin-right:10px; display:flex; align-items:center; cursor:pointer;">
                                <input type="checkbox" ${ev.highlight ? 'checked' : ''} onchange="updateEvent(${dayIndex}, ${evIndex}, 'highlight', this.checked)" style="width:auto; margin-right:5px;"> 
                                Highlight
                            </label>
                            <input type="color" value="${ev.color || '#c92b2b'}" 
                                style="display:${showColor}; height:25px; width:40px; border:none; background:none; cursor:pointer;"
                                onchange="updateEvent(${dayIndex}, ${evIndex}, 'color', this.value)" title="Highlight Farbe w√§hlen">
                        </div>
                        <button class="btn-icon btn-delete" onclick="deleteEvent(${dayIndex}, ${evIndex})">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(el);
            });
        }

        function addEvent(dayIndex) {
            events[dayIndex].push({ title: '', host: '', loc: '', time: '', price: '', info: '', color: '#c92b2b' });
            renderEvents(dayIndex);
            updatePreview();
        }

        function updateEvent(dayIndex, evIndex, field, value) {
            events[dayIndex][evIndex][field] = value;
            if(field === 'highlight') {
                // Re-render to update border color immediately
                renderEvents(dayIndex);
            }
            updatePreview();
        }

        function deleteEvent(dayIndex, evIndex) {
            events[dayIndex].splice(evIndex, 1);
            renderEvents(dayIndex);
            updatePreview();
        }

        function updatePreview() {
            let tempDate = new Date(currentWeekStart);

            const generateDayHtml = (idx) => {
                const dateStr = tempDate.toLocaleDateString('de-DE', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });
                const dayEvents = events[idx];
                
                let eventsHtml = '';
                if (dayEvents.length === 0) {
                     eventsHtml = `<div style="margin-bottom: 15px; padding: 15px; background-color: #252525; border-radius: 6px; color:#888; text-align:center; border:1px solid #333;">keine Events</div>`;
                } else {
                    dayEvents.forEach(ev => {
                        const hColor = ev.color || '#c92b2b';
                        const r = parseInt(hColor.slice(1, 3), 16);
                        const g = parseInt(hColor.slice(3, 5), 16);
                        const b = parseInt(hColor.slice(5, 7), 16);
                        const bgStyle = ev.highlight ? `background-color: rgba(${r}, ${g}, ${b}, 0.15);` : 'background-color: #252525;';
                        
                        const borderStyle = ev.highlight ? `border-left: 4px solid ${hColor};` : 'border-left: 4px solid #444;';
                        const imgHtml = ev.img ? `<div style="margin-bottom:12px;"><img src="${ev.img}" style="max-width:100%; border-radius:4px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>` : '';
                        const infoHtml = ev.info ? `<div style="margin-top:8px; font-style:italic; font-size:0.9em; color:#bbb; border-top:1px dashed #444; padding-top:5px;">${ev.info.replace(/\n/g, '<br>')}</div>` : '';
                        
                        eventsHtml += `
                        <div style="margin-bottom: 15px; padding: 15px; ${bgStyle} border-radius: 6px; color:#bbb; ${borderStyle} box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                            ${imgHtml}
                            <div style="color:#fff; font-weight:bold; font-size:1.1em; margin-bottom:8px; border-bottom:1px solid #3a3a3a; padding-bottom:5px;">${ev.title}</div>
                            <div style="line-height:1.6;">
                                <strong style="color:#888;">Veranstalter:</strong> ${ev.host}<br />
                                <strong style="color:#888;">Ort:</strong>&nbsp;${ev.loc}<br />
                                <strong style="color:#888;">Uhrzeit:</strong> ${ev.time}<br />
                                <strong style="color:#888;">Eintritt:</strong> ${ev.price}
                            </div>
                            ${infoHtml}
                        </div>`;
                    });
                }

                tempDate.setDate(tempDate.getDate() + 1); // Advance date for next call

                return `
                <div style="width: 35%; margin: 10px; padding: 20px; border: 1px solid #333; border-radius: 8px; background-color: #1e1e1e; box-sizing:border-box; flex: 1 1 400px; max-width: 500px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                    <p style="margin-top:0; margin-bottom:20px; color:#c92b2b; font-size:1.3em; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid #333; padding-bottom:10px;"><strong>${dateStr}</strong></p>
                    ${eventsHtml}
                </div>`;
            };


            // START WRAPPER
            let html = `<!-- GRUNDGER√úST (WRAPPER) -->
<div style="position: relative; width: 100%; max-width: 1190px; box-sizing: border-box; margin:0 auto; padding:0; font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color:#121212; color:#e0e0e0; -webkit-font-smoothing: antialiased;">

  <!-- HAUPT-CONTAINER -->
  <div style="width:90%; max-width:1100px; margin:40px auto;">

    <br />

    <p style="color:#e0e0e0; font-size:1.1em; text-align:center;"><strong>Der Eventkalender wird von uns auch nach Ver√∂ffentlichung aktualisiert, sofern neue Veranstaltungen innerhalb der Woche dazu kommen, √∂fter reinschauen kann sich also lohnen!&nbsp;</strong></p>
    
    <div style="height:1px; background-color:#333; margin: 20px 0; width:100%;"></div>

    <p style="color:#cccccc; text-align:center;">Planen Sie auch eine Veranstaltung oder Ihre Veranstaltung nicht mit dabei? Dann schreiben Sie&nbsp;Weazel News eine Venture Mail mit allen Informationen zur Veranstaltung.</p>
    
    <div style="height:1px; background-color:#333; margin: 20px 0; width:100%;"></div>
    <br />
`;

            // Reset tempDate for loop
            tempDate = new Date(currentWeekStart);
            
            // Mo & Di
            html += `<div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">`;
            html += generateDayHtml(0); // Mo
            html += generateDayHtml(1); // Di
            html += `</div>`;

            // Mi & Do
            html += `<div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">`;
            html += generateDayHtml(2); // Mi
            html += generateDayHtml(3); // Do
            html += `</div>`;

             // Fr & Sa
            html += `<div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">`;
            html += generateDayHtml(4); // Fr
            html += generateDayHtml(5); // Sa
            html += `</div>`;

            // So
            html += `<div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">`;
            html += generateDayHtml(6); // So
            html += `</div>`;

            html += `
    <div style="height:1px; background-color:#333; margin: 40px 0; width:100%;"></div>
    <p style="font-size:0.9em; color:#888; text-align:center;">Alle Angaben ohne Gew√§hr. Kurzfristige √Ñnderungen sind beim Veranstalter zu erfahren. Ihr Event ist nicht dabei? Melden Sie sich gerne per VentureMail direkt bei&nbsp;Weazel News um Ihre Veranstaltung anzumelden.</p>

  </div> <!-- END HAUPT-CONTAINER -->

  <!-- FOOTER -->
  <div style="width:100%; padding:30px 0; background-color:#161616; border-top:1px solid #333; text-align:center; color:#666; font-size:0.9em; margin-top:60px;">
    <p style="margin:0 0 10px 0;">¬© 2026 Weazel News. Alle Rechte vorbehalten.</p>
    <div style="margin-top:10px;">
      <span style="margin:0 10px; cursor:pointer; color:#888;">Sie haben Fragen, Anregungen oder Kritik an unser Weazel News Team? Melden Sie sich gerne bei uns unter unserer Hotline 444 222 oder per VentureMail direkt an Weazel News.</span>
    </div>
  </div>

</div> <!-- END WRAPPER -->`;

            document.getElementById('previewContent').innerHTML = html;
            document.getElementById('outputCode').value = html;
        }

        function copyCode() {
            const copyText = document.getElementById("outputCode");
            copyText.select();
            document.execCommand("copy");
        }

        function importCode() {
            const code = document.getElementById('importCodeInput').value;
            if (!code) return;

            const parser = new DOMParser();
            const doc = parser.parseFromString(code, 'text/html');

            // Reset current events
            for(let i=0; i<7; i++) events[i] = [];

            // Helper to clean text
            const clean = (str) => str ? str.replace(/\s+/g, ' ').trim() : '';

            // 1. Detect Start Date (Global Check)
            // Search systematically for any date format DD.MM.YYYY
            const allText = doc.body.textContent;
            const dateMatch = allText.match(/(\d{2})\.(\d{2})\.(\d{4})/);
            if(dateMatch) {
                // Determine if this is start of week or random date.
                // We'll trust the first date found usually, or find "Montag, ..."
                // Let's try to find Montag explicitly
                const mondayMatch = allText.match(/Montag.*?(\d{2})\.(\d{2})\.(\d{4})/);
                if(mondayMatch) {
                     const d = new Date(`${mondayMatch[3]}-${mondayMatch[2]}-${mondayMatch[1]}`);
                     if(!isNaN(d)) {
                        currentWeekStart = d;
                        document.getElementById('startDate').valueAsDate = d;
                     }
                } else {
                     // Fallback to first date found
                     const d = new Date(`${dateMatch[3]}-${dateMatch[2]}-${dateMatch[1]}`);
                     if(!isNaN(d)) {
                         // Attempt to reset to Monday if this date is not Monday
                         const day = d.getDay() || 7; // 1=Mon, 7=Sun
                         d.setDate(d.getDate() - (day - 1));
                         currentWeekStart = d;
                         document.getElementById('startDate').valueAsDate = d;
                     }
                }
            }

            // 2. Find Day Columns
            // We look for the columns based on the day names.
            // Strategy: Find an element containing "Montag", walk up to find the container column.
            const dayKeywords = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];
            
            dayKeywords.forEach((dayName, index) => {
                // Find all elements containing the day name
                // filtering for those that likely also contain a date or are headers
                const candidates = Array.from(doc.querySelectorAll('*')).filter(el => {
                    // Start with leaf nodes or mostly text nodes
                    return el.children.length < 3 && el.innerText.includes(dayName);
                });

                // From candidates, find the one that looks like a header (p or strong usually)
                // And then find its parent container (the column)
                let column = null;
                for (const el of candidates) {
                    // Check if text looks like "DayName, DD.MM.YYYY" or "DayName (DD.MM.YYYY)"
                    // Or just strict DayName match
                    if(el.innerText.includes(dayName)) {
                        // Traverse up to find a container with width: 35% or similar class
                        let parent = el.parentElement;
                        while(parent && parent !== doc.body) {
                            const style = (parent.getAttribute('style') || '').toLowerCase();
                            // The snippet uses "width: 35%" or "flex: 1"
                            if(style.includes('width: 35%') || style.includes('width:35%') || style.includes('flex: 1') || style.includes('flex:1')) {
                                column = parent;
                                // Double check: Ensure this column doesn't belong to another day keyword appearing earlier
                                // (Unlikely given separate columns)
                                break;
                            }
                            parent = parent.parentElement;
                        }
                    }
                    if(column) break;
                }

                if (!column) return; // No column found for this day

                // Now extract events from this column
                const eventDivs = Array.from(column.children).filter(child => {
                    const style = (child.getAttribute('style') || '').toLowerCase();
                    // Events usually have background-color AND border-radius
                    // And usually border-left (but could be highlight background)
                    // Exclude the header (which is usually a <p>)
                    if(child.tagName === 'P') return false; 
                    if(child.innerText.includes('keine Events')) return false;
                    
                    // Specific check based on user snippet:
                    // <div style="... background-color: #252525 ..."> or similar
                    return style.includes('background-color') && style.includes('border-radius');
                });

                eventDivs.forEach(div => {
                    // Default values
                    let title = "Event";
                    let img = "";
                    let info = "";
                    let host = "";
                    let loc = "";
                    let time = "";
                    let price = "";
                    let highlight = false;
                    let color = '#c92b2b';

                    // 1. Analyze Style for Highlight
                    const style = (div.getAttribute('style') || '').toLowerCase();
                    if(style.includes('border-left')) {
                         // Highligth check: if border color is distinct or background is reddish
                         const borderColorMatch = style.match(/border-left:\s*4px\s*solid\s*(#[0-9a-f]{3,6}|rgb\([^)]+\))/i);
                         if(borderColorMatch) {
                             const c = borderColorMatch[1].toLowerCase();
                             if(c !== '#444' && c !== '#444444' && !c.includes('68, 68, 68')) {
                                 highlight = true;
                                 // Try to use the color found
                                 // Clean up hex
                                 if(c.startsWith('#')) color = c;
                             }
                         }
                    }

                    // 2. Title
                    // Provide robust search for title div
                    const potentialTitle = div.querySelector('div[style*="font-weight:bold"], div[style*="font-size:1.1em"]');
                    if(potentialTitle) {
                        title = clean(potentialTitle.textContent);
                    } else {
                        // Fallback: the first non-empty div or element could be title
                        // Or look for text before "Veranstalter"
                    }

                    // 3. Details (Parsing text content by splitting)
                    // The snippet is unstructured text separated by <br> usually
                    const fullText = div.innerText; // "Title\nVeranstalter: XYZ\nOrt: ABC..."
                    
                    const extractVal = (key) => {
                        if(!fullText.includes(key)) return '';
                        const parts = fullText.split(key);
                        if(parts.length < 2) return '';
                        // Take the part after key, split by newline to get just the value
                        let val = parts[1].split('\n')[0];
                        return clean(val);
                    }

                    host = extractVal('Veranstalter:');
                    loc = extractVal('Ort:');
                    time = extractVal('Uhrzeit:');
                    price = extractVal('Eintritt:');

                    // 4. Image
                    const imgTag = div.querySelector('img');
                    if(imgTag) img = imgTag.src;

                    // 5. Info
                    // Usually italic
                    const infoTag = div.querySelector('div[style*="font-style:italic"]');
                    if(infoTag) info = clean(infoTag.textContent);

                    events[index].push({
                        title, img, info, host, loc, time, price, highlight, color
                    });
                });
            });

            renderDays();
            updatePreview();
            showNotification("Kalender erfolgreich importiert!", "success");
        }

        function showNotification(msg, type='info') {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.className = 'notification show ' + type;
            
            setTimeout(() => {
                toast.className = 'notification';
            }, 3000);
        }

        init();
    </script>
</body>
</html>